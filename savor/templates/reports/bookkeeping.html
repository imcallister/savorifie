{% extends base_template %}
{% load staticfiles %}
{% load humanize %}


{% block breadcrumb %}
<li class="active">Home</li>

{{ block.super }}
{% endblock %}


{% block content %}

<div class="container-fluid" id="wrapper">
    <div class="row">
        <div class="col-md-4">    
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">File Uploads</h3>
                </div>
                <div class="panel-body">
                    <div>
                        <div class="row">
                            <div>
                                <table class="table table-striped table-condensed">
                                    <thead>
                                        <th></th>
                                        <th style = "text-align: right;">Loaded Thru</th>
                                    </thead>
                                    <tbody>
                                        {% for row in upload_rows %}
                                            <tr>
                                                <td>{{row.0}}</td>
                                                <td align="right">
                                                    {{row.1}}</a>
                                                </td>
                                            </tr>    
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">    
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Reconciliation Reports</h3>
                </div>
                <div class="panel-body">
                    <div>
                        <ul class="nav nav-pills nav-stacked">
                            <li><a class="btn btn-info" data-toggle="modal" data-target="#UPSInvoices">UPS Invoices</a></li>
                            <li><a class="btn btn-info" data-toggle="modal" data-target="#misUPS">UPS Mis-Billed</a></li>
                            <li><a class="btn btn-info" data-toggle="modal" data-target="#shopifyUnpaid">View Unpaid Shopify</a></li>
                            <li><a class="btn btn-info" data-toggle="modal" data-target="#shopifyComp">View Shopify Payouts</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">    
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Uploads</h3>
                </div>
                <div class="panel-body">
                    <div>
                        <ul class="nav nav-pills nav-stacked">
                            <li><a class="btn btn-warning" data-toggle="modal" data-target="#loadFirstRepublic">Load First Republic</a></li>
                            <li><a class="btn btn-warning" data-toggle="modal" data-target="#loadMasterCard">Load Mastercard</a></li>
                            <li><a class="btn btn-warning" data-toggle="modal" data-target="#loadUPS">Load UPS</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="row">
        <div class="col-md-8">    
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Expenses</h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="panel panel-danger">
                                <div class="panel-heading text-center">
                                    <h3 class="panel-title">INCOMPLETE</br>EXPENSES</h3>
                                </div>
                                <div class="panel-body text-center">
                                    <font size="20"><a href='/admin/base/expense/?unmatched=UNMATCHED'>{{incomplete_expenses}}</a></font>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="panel panel-warning">
                                <div class="panel-heading text-center">
                                    <h3 class="panel-title">INCOMPLETE</br>BANKING ENTRIES</h3>
                                </div>
                                <div class="panel-body text-center">
                                    <font size="20"><a href='/admin/base/cashflow/?unmatched=UNMATCHED'>{{incomplete_banking}}</a></font>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="panel panel-warning">
                                <div class="panel-heading text-center">
                                    <h3 class="panel-title">INCOMPLETE</br>CREDIT CARD ENTRIES</h3>
                                </div>
                                <div class="panel-body text-center">
                                    <font size="20"><a href='/admin/base/creditcardtrans/?unmatched=UNMATCHED'>{{incomplete_mcard}}</a></font>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Payables</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-striped table-condensed">
                        <thead>
                            <th>Counterparty</th>
                            <th style = "text-align: right;">Amount</th>
                        </thead>
                        <tbody>
                            {% for row in ap_rows %}
                                <tr>
                                    <td>{{row.0}}</td>
                                    <td align="right">
                                        <a href="{{row.2}}">{{row.1|floatformat:2|intcomma}}</a>
                                    </td>
                                </tr>    
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div> <!-- col-md-6-->

        <div class="col-md-4">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Receivables</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-striped table-condensed">
                        <thead>
                            <th>Counterparty</th>
                            <th style = "text-align: right;">Amount</th>
                        </thead>
                        <tbody>
                        {% for row in ar_rows %}
                            <tr>
                                <td>{{row.0}}</td>
                                <td align="right">
                                    <a href="{{row.2}}">{{row.1|floatformat:0|intcomma}}</a>
                                </td>
                            </tr>    
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Upcoming Due Dates</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-striped table-condensed">
                        <thead>
                            <th>Date</th>
                            <th>Counterparty</th>
                            <th style = "text-align: right;">Amount</th>
                        </thead>
                        <tbody>
                        
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal -->

<div class="modal fade" id="createTransfer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h3 class="modal-title" id="myModalLabel">Upload Shopify order file</h3>
      </div>
      <div class="modal-body">
        <p>Please choose a .csv file</p>

        <form role='form' enctype="multipart/form-data" method="post" action="/base/shopify_upload/">{% csrf_token %}
            <div class="form-group">    
                {{shopify_upload_form.as_p}}
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
            <a href='/' class="btn btn-default">Cancel</a>
        </form>

      </div>
      
    </div>
  </div>
</div>


<div class="modal fade" id="showBatches" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h3 class="modal-title">Recent Batches</h4>
      </div>
      <div class="modal-body">
        <div class="container-fluid" id="wrapper">
          {% include "splashdict.html" with columns=batch_columns rows=batch_rows %}
        </div>
      </div>
      
    </div>
  </div>
</div>


<div class="modal fade" id="loadFirstRepublic" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h3 class="modal-title" id="myModalLabel">Upload First Republic activity</h3>
      </div>
      <div class="modal-body">
        <p>Please choose a .csv file</p>

        <form role='form' enctype="multipart/form-data" method="post" action="/base/upload/frbchecking/">{% csrf_token %}
            <div class="form-group">    
                {{upload_form.as_p}}
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
            <a href='/' class="btn btn-default">Cancel</a>
        </form>

      </div>
      
    </div>
  </div>
</div>

<div class="modal fade" id="loadUPS" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h3 class="modal-title" id="myModalLabel">Upload UPS charges</h3>
      </div>
      <div class="modal-body">
        <p>Please choose a .csv file</p>

        <form role='form' enctype="multipart/form-data" method="post" action="/importers/ups_upload/">{% csrf_token %}
            <div class="form-group">    
                {{upload_form.as_p}}
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
            <a href='/' class="btn btn-default">Cancel</a>
        </form>

      </div>
      
    </div>
  </div>
</div>
<div class="modal fade" id="loadMasterCard" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h3 class="modal-title" id="myModalLabel">Upload Mastercard activity</h3>
      </div>
      <div class="modal-body">
        <p>Please choose a .ofx file</p>

        <form role='form' enctype="multipart/form-data" method="post" action="/base/upload/mastercard/">{% csrf_token %}
            <div class="form-group">    
                {{upload_form.as_p}}
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
            <a href='/' class="btn btn-default">Cancel</a>
        </form>

      </div>
      
    </div>
  </div>
</div>

<div class="modal fade" id="help" tabindex="-1" role="dialog" aria-labelledby="helpLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
        <h3>Payables and Receivables</h3>        
        Payables and receivables shows net money owed to or from a counterparty. There may be a combination of money due to and from ... e.g. for Shopify there are monthly charges for which expenses must be created and receivables which correspond to the proceeds from sales (after Shopify fees).

        <h3>Payables</h3>
        <p>
            Bank payments are loaded first and so most often we have an outgoing cash payment without the matching expense. This will show up as a negative amount here. When there are no more payables showing here then it is a sign that all necessary expenses have been created.
            </br>
            Choosing checkbox and clicking bulk create will create expenses for that counterparty. It will not create duplicates. But we don't create expenses for all counterparties. Positive amounts show that we have net receivables. This should be the minority. The difficult ones normally require some accounting expertise so contact Ian for any that are unclear.

        </p>
        <h3>Receivables</h3>
        <p>
            This will mostly show money due from channels. Clicking on the link will show the history with that channel.
            </br>
            There are no book-keeping entries required -- this report is for help in tracking outstanding amounts owed to Shopify. Bank activity needs to be up to date in order to track this.

        </p>
      </div>
      
    </div>
  </div>
</div>

<div class="modal fade" id="unreconciled" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-content">
        {{unreconciled}}
    </div>
</div>


<div class="modal fade" id="shopifyUnpaid" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-content">
        {{shopify_unpaid}}
    </div>
</div>


<div class="modal fade" id="shopifyComp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-content">
        {{shopify_comparison}}
    </div>
</div>


<div class="modal fade" id="NC2Billing" tabindex="-1" role="dialog" aria-labelledby="helpLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
        <h3>NC2 Handling Charges</h3>        
        {{NC2Billing}}
      </div>
      
    </div>
  </div>
</div>

<div class="modal fade" id="UPSInvoices" tabindex="-1" role="dialog" aria-labelledby="helpLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
        <h3>UPS Invoices</h3>        
        {{UPS_invoices}}
      </div>
      
    </div>
  </div>
</div>

<div class="modal fade" id="misUPS" tabindex="-1" role="dialog" aria-labelledby="helpLabel">
    <div class="modal-content">
        <h3>Mis-billed UPS charges</h3>        
        {{mis_UPS}}
    </div>
</div>

{% endblock %}

{% block sidebar %}
<div class="panel panel-default">
    <div class="panel-body">
      <a class="btn btn-success btn-lg" data-toggle="modal" data-target="#help">
        <span style="font-size:2em;" class="glyphicon  glyphicon-question-sign" aria-hidden="true"></span>
      </a>
    </div>
</div>
{% endblock %}

{% block extrajs %}
    <script src="{{ STATIC_URL }}highcharts/js/highcharts.js"></script>
    <script src="{{ STATIC_URL }}highcharts/js/modules/exporting.js"></script>
    <script src="{{ STATIC_URL }}charts/chartdefs.js"></script>
    <script src="{{ STATIC_URL }}base/js/easypiechart.js"></script>
    
    <script src="{{ STATIC_URL }}base/js/jquery.align-column.js"></script>
    <script src="{{ STATIC_URL }}base/js/bootstrap-table.js"></script>
    <script src="{{ STATIC_URL }}base/js/bootstrap-table-filter-control.js"></script>

    <script src="{{ STATIC_URL }}base/js/bootstrap-table-editable.js"></script>
    <script src="{{ STATIC_URL }}base/js/bootstrap-editable.js"></script>
    <script src="{{ STATIC_URL }}base/js/tableExport.js"></script>
    <script src="{{ STATIC_URL }}base/js/bootstrap-table-export.js"></script>
{% endblock %}